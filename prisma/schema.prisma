// Link Inteligente de Checkout — Modelagem para campanhas de tráfego pago
// Produto → Grupos de Checkout → Checkouts (URLs) | Link Inteligente aponta para um grupo

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// Simplified campaign model to make domain easier to understand:
/// Campaign  <- Endpoint[]  (each endpoint is a checkout URL)
/// CampaignLink (slug) -> points to a Campaign
model Campaign {
  id        String    @id @default(cuid())
  name      String
  autoCheckEnabled Boolean @default(false)
  autoCheckInterval Int     @default(60) // seconds
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  endpoints Endpoint[]
  links     CampaignLink[]
}

model Endpoint {
  id                  String   @id @default(cuid())
  campaignId          String
  campaign            Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  url                 String
  priority            Int      @default(0)
  isActive            Boolean  @default(true)
  lastError           String?
  lastCheckedAt       DateTime?
  lastUsedAt          DateTime?
  consecutiveFailures Int      @default(0)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  @@index([campaignId])
}

model CampaignLink {
  id         String   @id @default(cuid())
  slug       String   @unique
  campaignId String
  campaign   Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  fallbackUrl String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  passwordHash String
  name         String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}
